<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>株価情報</title>
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="css/clean.css">
</head>
<body class="yui3-skin-sam">
	<form action="#" method="get" id="theForm">
		<p>最新の株価を調べるには、テキストフィールドに株のティッカーシンボルを入力してください。</p>
		<p><label for="symbol">ティッカーシンボル <input type="text" name="symbol" id="symbol"></label><span id="output"></span></p>
		<p><input type="submit" value="送信"></p>
	</form>
	<script src="http://yui.yahooapis.com/3.4.1/build/yui/yui-min.js"></script>	
	<script>
	// YUIのロード
	YUI().use('console', 'node', 'yql',function(Y) {
		
		// DOMの準備ができたら、ステージを設定する
		Y.on('domready', function() {

			// デバッグ用
			var yconsole = new Y.Console();
			yconsole.render();
			
			// 必要な参照を取得
			var symbol = Y.one('#symbol');
			var output = Y.one('#output');
			
			// フォームの送信の処理
			Y.one('#theForm').on('submit', function(e) {
				
				// フォームの送信を回避
				e.preventDefault();

				// 表示する文字の変更
				output.set('text', '...調べています...');
				// クエリを実行
				Y.YQL('select Name, LastTradePriceOnly FROM yahoo.finance.quotes WHERE symbol="' + symbol.get('value') + '"', function(result) {

					output.set('text', result.query.results.quote.Name + ': $' + result.query.results.quote.LastTradePriceOnly);

					// デバッグ
					// Y.log(result);

				}); // YQLの終わり
			
			}); // フォームの送信の終わり
			
		}); // Y.on('domready')の終わり
	
	}); // YUI().use()の終わり
	</script>
</body>
</html>